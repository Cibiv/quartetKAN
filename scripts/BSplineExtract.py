# -*- coding: utf-8 -*-

import numpy as np
import pandas as pd
import tensorflow.keras as keras
import os
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("-m", "--model", help="Model to test.")
parser.add_argument("-t", "--test", default='../data/processed/zone/test/1000bp', help="Path to test directory")
parser.add_argument("-o", "--offset", type=int, default=4, help="Index of first feature column.")
parser.add_argument("-n", "--no_feat", type=int, default=15, help="Number of feature columns.")
args = vars(parser.parse_args())

#Modell laden
model = keras.saving.load_model(args['model'])
model.summary()
'''
#Testdatei auswählen
test_files = [f for f in os.listdir(args["test"]) if f.endswith('.csv')]
if not test_files:
    raise FileNotFoundError("Keine Testdateien gefunden!")

test_file = test_files[0]  # Erste Datei aus dem Verzeichnis nehmen
df = pd.read_csv(f'{args["test"]}/{test_file}')

#beispiel-Frequenzvektor extrahieren (erste Zeile der Feature Spalten)
offset = args["offset"]
no_feat = args["no_feat"]
feature_vector = df.iloc[0, offset:offset + no_feat].values  #erster vektor

#in numpy-Array umwandeln und die Form anpassen
feature_vector = np.array(feature_vector, dtype=np.float32).reshape(1, -1)

#modell anwenden
output = model.predict(feature_vector)

#ergebnis 
print("Beispiel-Frequenzvektor:", feature_vector)
print("Model Output:", output)
'''
#anschauen was es für layer gibt: 
#model.summary()
#auf den i-ten layer des models mit models.layers[i] zugreifen
#hidden layer:
print("layer 0:\n")
print(model.layers[0])

#zweite hidden layer? layer:
print("layer 1:\n")
print(model.layers[1])

#erste hidden layer weights: 
print("layer 0 weights:\n")
print(model.layers[0].weights)

'''
layer 0 weights:

[<tf.Variable 'dense_kan/spline_kernel:0' shape=(15, 8, 4) dtype=float32, numpy=
array([[[ 2.07415462e-01, -9.71448720e-02,  1.49482727e-01,
          3.72168794e-02],
        [ 3.03977728e-02,  1.52810961e-01, -1.32852301e-01,
          8.60523805e-02],
        [ 2.26895452e+00,  1.72307536e-01, -9.27524686e-01,
         -3.67889619e+00],
        [ 2.09062591e-01,  2.45435521e-01,  4.66470391e-01,
          5.30086875e-01],
        [ 1.96631238e-01, -2.72479266e-01, -3.56083274e-01,
         -2.23022610e-01],
        [-4.50245261e-01, -3.86513829e-01, -3.77707899e-01,
         -2.06162110e-01],
        [-1.42396677e+00,  2.68180668e-01, -2.38027915e-01,
         -9.06294286e-01],
        [-2.35988781e-01,  1.37921846e+00,  5.43136716e-01,
         -1.00886714e+00]],

       [[ 1.15845673e-01, -6.83117732e-02,  1.94050387e-01,
         -4.85442718e-03],
        [ 1.51464835e-01,  1.09425485e-01,  1.07614864e-02,
          8.61918926e-03],
        [ 1.15548873e+00,  2.46210366e-01,  2.93210196e+00,
         -5.91891146e+00],
        [-5.13822496e-01, -4.57288772e-01,  2.03304425e-01,
         -3.72619390e-01],
        [ 3.76654327e-01,  3.64690095e-01, -1.98157772e-01,
          4.75417823e-01],
        [-2.30182514e-01, -3.63135487e-01, -3.85348648e-01,
         -8.51707995e-01],
        [-3.05631313e+01, -2.02492161e+01, -1.98068409e+01,
          1.71468582e+01],
        [-1.80490073e-02,  8.61513540e-02, -1.81273624e-01,
         -2.49032646e-01]],

       [[-6.12142077e-03,  1.27366588e-01, -7.15778535e-03,
          2.02606007e-01],
        [-8.07349980e-02, -6.18121624e-02, -2.74751671e-02,
          5.01964502e-02],
        [ 1.53574669e+00, -1.17526686e+00,  3.05017257e+00,
         -2.23403502e+00],
        [ 4.99931931e-01,  3.66610080e-01,  4.66188580e-01,
         -4.48942393e-01],
        [-4.38333780e-01, -2.00073570e-01, -2.42446467e-01,
          4.09369111e-01],
        [ 3.94990668e-03, -1.47960639e+00,  5.52402399e-02,
         -8.63373950e-02],
        [-3.31606650e+00,  2.93188977e+00,  2.94207239e+00,
         -2.88768315e+00],
        [-2.82019135e-02,  5.05037792e-02, -1.33442134e-01,
         -8.18408057e-02]],

       [[-2.36475825e-01,  7.88212940e-02,  5.51302545e-02,
          1.50096714e-01],
        [ 6.79079536e-03,  1.34199277e-01, -2.00170040e-01,
          4.46788967e-02],
        [-1.91289341e+00,  4.13289309e+00,  1.31737977e-01,
         -3.48723626e+00],
        [-2.38076091e-01,  1.69512525e-01, -1.51609004e-01,
         -1.24119289e-01],
        [ 2.33623132e-01, -3.19561303e-01, -1.16139771e-02,
          2.90548205e-01],
        [-5.85074425e-01,  4.34232026e-01,  8.13369691e-01,
         -1.55618477e+00],
        [-2.32565880e-01,  4.70884815e-02,  7.62916088e-01,
         -2.22009349e+00],
        [-4.30360176e-02,  1.77686531e-02,  2.63295043e-03,
         -3.46169807e-02]],

       [[-1.83980718e-01,  5.05546220e-02, -8.65698513e-03,
          2.50363834e-02],
        [-4.08791229e-02,  1.61883026e-01, -1.23067096e-01,
          2.36743987e-02],
        [-4.24681306e-01,  1.12225175e+00, -2.75001526e+00,
          3.77804613e+00],
        [-2.38906950e-01, -3.36555183e-01,  3.67441833e-01,
          1.16376795e-01],
        [ 2.54394054e-01, -1.30788991e-02, -4.57295291e-02,
         -2.51572996e-01],
        [-1.28123164e+00,  1.75402188e+00, -1.89933503e+00,
         -1.10215880e-02],
        [ 8.11352968e-01, -1.06395423e+00,  2.10466051e+00,
         -4.82984871e-01],
        [-1.61904097e-01, -1.13729239e-01,  7.53624961e-02,
         -1.08939623e-02]],

       [[ 6.78947836e-04, -4.50691618e-02, -8.47672112e-03,
         -1.02665342e-01],
        [ 3.75654711e-03, -2.23598517e-02,  5.36952429e-02,
         -6.31534979e-02],
        [-1.01059914e+00, -4.01871777e+00,  1.30218589e+00,
          2.82815766e+00],
        [-5.05035877e-01, -3.12149286e-01, -1.48742616e-01,
          4.72721338e-01],
        [ 3.12868685e-01,  3.12319607e-01, -2.16607470e-02,
         -3.79639894e-01],
        [-7.53475964e-01, -1.21125138e+00,  4.34575438e-01,
          2.71586746e-01],
        [-5.67309523e+00,  7.81285763e+00, -7.45549774e+00,
          5.67675924e+00],
        [-6.20956793e-02, -5.85690513e-02, -5.35604218e-03,
          5.07474132e-02]],

       [[-6.28030598e-02,  2.36851219e-02, -3.32197584e-02,
         -7.41713261e-03],
        [ 9.57277194e-02,  2.08243966e-01,  2.85927933e-02,
         -8.40468332e-02],
        [-4.08557224e+00, -2.95946288e+00,  6.25921428e-01,
          5.62111512e-02],
        [-3.34479436e-02, -1.62780330e-01, -2.85152704e-01,
          3.35207939e-01],
        [ 1.32482171e-01,  2.86167383e-01,  9.21554118e-02,
         -9.29164961e-02],
        [-1.24083364e+00, -1.95456064e+00,  1.34941077e+00,
         -2.09304881e+00],
        [-2.94739056e+00,  1.17768025e+00,  2.15092826e+00,
          1.55987990e+00],
        [-3.00532766e-02,  8.83491244e-03, -2.88731642e-02,
          1.00689009e-01]],

       [[ 1.07147537e-01, -1.70467736e-03, -9.37220827e-02,
          1.39510902e-02],
        [-7.64766559e-02,  4.24505025e-02, -6.08539097e-02,
          1.34926438e-02],
        [-3.44103360e+00,  2.77906990e+00, -7.28767693e-01,
          1.58145785e+00],
        [-4.42583144e-01, -1.62463114e-01, -5.38534939e-01,
         -7.02759683e-01],
        [ 2.87459880e-01, -2.53276467e-01,  2.23638192e-01,
          4.70023721e-01],
        [ 4.53676164e-01,  1.91615653e+00, -9.97678190e-02,
          2.33672214e+00],
        [-8.76968145e-01, -2.41191372e-01, -3.14035058e+00,
         -3.87671024e-01],
        [ 1.19222276e-01,  4.05774656e-04, -1.99391738e-01,
         -7.01449141e-02]],

       [[ 5.47089167e-02, -1.94486946e-01, -8.17183778e-02,
         -6.90137371e-02],
        [ 2.13519018e-02, -2.20733602e-02,  1.42266378e-02,
          6.65903911e-02],
        [-2.44679403e+00,  2.84259200e+00, -4.30828810e+00,
          1.17782021e+00],
        [-3.37842882e-01,  3.72470498e-01, -2.23593950e-01,
         -1.97956949e-01],
        [ 4.54589993e-01, -1.60729960e-01,  2.36448750e-01,
         -1.71865448e-01],
        [ 4.17544484e-01, -1.49725187e+00, -1.32777297e+00,
          1.50391757e+00],
        [ 2.78660154e+00,  1.70627940e+00,  8.39968443e-01,
         -1.30430007e+00],
        [ 1.65616628e-02, -1.16467454e-01,  4.62108962e-02,
          1.24880090e-01]],

       [[-1.62151717e-02,  8.89964402e-02, -1.11882843e-01,
         -1.35892987e-01],
        [ 2.01510768e-02, -1.04506247e-01,  1.38549199e-02,
         -4.72709723e-02],
        [ 2.44473720e+00, -1.34408867e+00,  3.98405623e+00,
          3.52092314e+00],
        [ 4.88989115e-01,  1.45531684e-01,  4.25776571e-01,
          7.16316819e-01],
        [-3.82180691e-01, -5.89821674e-02, -2.81223774e-01,
         -2.66793609e-01],
        [-1.38632119e-01, -9.83894169e-01,  2.43880972e-02,
         -1.53344524e+00],
        [ 6.81836891e+00,  2.59966254e+00, -4.16138554e+00,
          1.80288851e+00],
        [-8.72389507e-03, -1.25472978e-01, -1.24378256e-01,
         -7.08976910e-02]],

       [[ 1.17419422e-01,  1.06622663e-03,  5.75836599e-02,
         -1.12778572e-02],
        [-1.82371698e-02, -9.12130624e-02,  9.31387097e-02,
         -4.51924801e-02],
        [-8.50728273e-01,  2.68774688e-01, -1.53811204e+00,
          3.99517393e+00],
        [-3.59588534e-01, -4.54266578e-01, -1.41804546e-01,
         -1.62694365e-01],
        [ 1.48064718e-01, -5.13900025e-03,  3.89735773e-02,
         -5.07489629e-02],
        [ 1.04333200e-01,  1.58767176e+00,  9.92236853e-01,
          2.05727458e+00],
        [-4.07392597e+00, -2.60822105e+00, -5.36296844e+00,
         -1.47228658e+00],
        [-1.69295743e-01,  7.55192041e-02,  2.53461942e-04,
         -4.06771563e-02]],

       [[ 2.41950210e-02,  1.70905679e-01, -3.24680167e-03,
          6.63192794e-02],
        [-6.17331974e-02,  6.19072206e-02, -5.60394302e-02,
          3.08291819e-02],
        [-1.32885551e+00,  3.56830907e+00,  1.47046435e+00,
         -3.99330050e-01],
        [-1.65752843e-01, -1.75976194e-02,  5.89947701e-01,
         -2.71890193e-01],
        [ 3.22896913e-02, -2.96445966e-01, -2.93377280e-01,
          2.23495916e-01],
        [ 3.33601594e-01,  1.77399039e+00, -1.53953183e+00,
          2.93228365e-02],
        [ 3.28781223e+00, -6.19351149e+00,  1.07544031e+01,
         -4.28800392e+00],
        [ 6.27124980e-02,  9.52791274e-02, -4.03364487e-02,
         -2.10373208e-01]],

       [[ 3.51709910e-02,  2.15351611e-01, -2.35233251e-02,
          1.75596580e-01],
        [-4.31301557e-02,  3.60625843e-03, -4.33211476e-02,
          2.65502613e-02],
        [ 1.48657894e+00, -4.40960407e-01, -3.11394858e+00,
         -1.52158546e+00],
        [-1.26777351e-01, -1.00197867e-01,  1.29088655e-01,
         -3.25356424e-01],
        [-2.69492865e-01, -9.67069566e-02,  1.86198488e-01,
          2.80290842e-01],
        [ 1.25175834e+00,  1.43293715e+00, -1.97526801e+00,
         -1.61263430e+00],
        [-8.18267822e+00,  4.74392563e-01, -3.90814328e+00,
         -4.16345978e+00],
        [-1.60122514e-01,  2.75377017e-02, -3.34297530e-02,
          9.63207409e-02]],

       [[-8.58212560e-02, -1.30309865e-01,  1.88143611e-01,
          2.13118225e-01],
        [ 1.78224906e-01,  2.91112214e-01,  5.47538395e-04,
         -1.90762244e-02],
        [ 6.33194029e-01,  2.76191473e+00,  3.54611444e+00,
         -1.96872485e+00],
        [ 2.54468560e-01, -8.87308344e-02, -2.69395337e-02,
         -3.02333921e-01],
        [-1.10026188e-01, -1.86471254e-01,  7.57234171e-02,
          2.44924709e-01],
        [-1.03785825e+00,  1.58701038e+00,  1.02481341e+00,
         -8.40585157e-02],
        [-5.92640066e+00, -2.93882251e+00,  5.50342202e-01,
         -2.85211861e-01],
        [-8.61193091e-02,  1.99906394e-01,  5.07014655e-02,
         -1.40689656e-01]],

       [[ 1.03897624e-01, -1.09851383e-01,  3.05736996e-02,
          1.36317551e-01],
        [ 1.40875969e-02,  2.24776417e-02,  4.56232019e-02,
          2.03555852e-01],
        [-1.02331407e-01, -3.58906239e-01, -6.31651580e-02,
          1.89640537e-01],
        [ 1.87717766e-01,  1.14191778e-01,  1.31531537e-01,
         -1.43616304e-01],
        [-1.82550073e-01, -7.49396086e-02, -1.14690483e-01,
          1.24841370e-01],
        [ 1.74043234e-02, -6.20354533e-01, -3.42421591e-01,
          1.10243249e+00],
        [-2.29606312e-02, -4.06990461e-02, -1.99696139e-01,
          7.68883899e-02],
        [ 1.16928078e-01, -1.54301645e-02,  5.30821681e-02,
         -1.20519154e-01]]], dtype=float32)>, <tf.Variable 'dense_kan/scale_factor:0' shape=(15, 4) dtype=float32, numpy=
array([[-3.8770151e-01, -2.8122732e-01, -1.3715111e-01, -9.0817541e-01],
       [ 1.8014770e+00,  1.6280744e+00, -1.1820362e+00,  2.5075440e+00],
       [ 2.0138369e+00,  4.8212886e-01,  8.7728506e-01, -1.4026147e+00],
       [-2.2913167e+00, -2.9362755e+00, -3.9859056e-01, -4.8555055e+00],
       [-1.1874063e+00,  2.2539842e+00, -2.2350547e+00,  1.0064391e+00],
       [ 1.9982344e+00, -4.0711489e+00,  1.5358418e-01, -1.9417237e+00],
       [ 3.4190643e+00, -5.9717922e+00,  2.1931880e+00,  1.2937938e+00],
       [ 2.4464145e+00, -2.6813772e+00,  1.2851673e+00,  1.9359064e+00],
       [-1.1480513e+00, -7.8833765e-01, -2.6971514e+00, -5.9054714e-01],
       [ 1.5435749e+00,  3.8253397e-01,  8.1280738e-01,  7.9902619e-01],
       [-1.0791786e+00,  2.2379038e+00, -1.4839184e+00,  2.3318744e+00],
       [-7.5451815e-01, -4.0103812e+00,  1.3126589e+00, -6.0851163e-01],
       [-7.9125565e-01, -1.2192167e+00,  1.6713842e+00, -1.8630681e+00],
       [-2.5327536e-01, -2.9455199e+00,  7.5839847e-01, -1.5335761e+00],
       [ 7.0125179e-04, -4.4412064e-04,  3.7688695e-04,  9.0543658e-01]],
      dtype=float32)>, <tf.Variable 'dense_kan/bias:0' shape=(4,) dtype=float32, numpy=array([ 0.01935269, -0.01453383,  0.01738286,  0.02968547], dtype=float32)>, <tf.Variable 'dense_kan/spline_grid:0' shape=(15, 12) dtype=float32, numpy=
array([[-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ],
       [-2.2       , -1.8000001 , -1.4000001 , -1.        , -0.6       ,
        -0.20000005,  0.20000005,  0.5999999 ,  1.        ,  1.4000001 ,
         1.8       ,  2.2       ]], dtype=float32)>]
(kan) lea@fermat:/project/phyloAI/quartetKAN/scripts> 
'''


#für dense layers erhält man die weights mit model.layers[i].weights
#print(model.layers[1].weights)
